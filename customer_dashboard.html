<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TN Messenger Service - Dashboard ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</title>

  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/feather-icons"></script>

  <style>
    :root {
      --primary: #1e3a8a;
      /* Blue-900 (‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Tracking) */
      --primary-light: #3b82f6;
      /* Blue-500 (‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô) */
      --secondary: #059669;
      /* Emerald-600 (‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô) */
      --text: #111827;
      /* Gray-900 */
      --text-light: #6b7280;
      /* Gray-500 */
      --bg: #f3f4f6;
      /* Gray-100 */
      --white: #ffffff;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Prompt', sans-serif;
      background: var(--bg);
      display: flex;
      min-height: 100vh;
      justify-content: center;
      padding: 30px 15px;
    }

    .main-container {
      width: 100%;
      max-width: 1000px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 38px;
      color: var(--primary);
      font-weight: 700;
      margin-bottom: 8px;
    }

    .header p {
      font-size: 18px;
      color: var(--text-light);
    }

    .action-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-top: 50px;
      margin-bottom: 20px;
    }

    /* üü¢ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (Secondary) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô" */
    .action-button {
      flex: 1;
      max-width: 300px;
      padding: 15px 25px;
      background: var(--secondary); 
      color: var(--white);
      font-size: 18px;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 10px rgba(5, 150, 105, 0.4);
    }

    /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞" ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏° (Primary) */
    .action-button.action-status {
      background: var(--primary);
      box-shadow: 0 4px 10px rgba(30, 58, 138, 0.4);
    }

    /* üîÑ ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£" ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô (Primary-light) */
    .action-button.action-news {
      background: var(--primary-light); 
      /* ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏á‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡πÉ‡∏´‡∏°‡πà (Blue-500: #3b82f6) */
      box-shadow: 0 4px 10px rgba(59, 130, 246, 0.4); 
    }

    .action-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    }

    .branch-section-title {
      font-size: 24px;
      font-weight: 600;
      color: var(--text);
      border-bottom: 2px solid var(--primary-light);
      padding-bottom: 10px;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .branch-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      text-align: center;
      margin-bottom: 40px;
    }

    .branch-card {
      background: transparent;
      padding: 0px;
      border-radius: 0px;
      box-shadow: none;
      border: none;
      font-weight: 700;
      color: var(--primary);
      font-size: 28px;
      text-align: center;
      transition: color 0.2s;
    }

    .branch-card:hover {
      background: none;
      color: var(--primary-light);
    }

    .loading-message {
      text-align: center;
      padding: 50px;
      color: var(--text-light);
      font-size: 16px;
    }

    .error-message {
      text-align: center;
      padding: 30px;
      background: #fee2e2;
      color: #b91c1c;
      border: 1px solid #ef4444;
      border-radius: 8px;
    }

    @media (max-width: 600px) {
      .header h1 {
        font-size: 30px;
      }

      .action-buttons {
        flex-direction: column;
        gap: 15px;
      }

      .action-button {
        max-width: 100%;
      }

      .branch-card {
        font-size: 24px;
      }
    }
  </style>
</head>

<body>
  <div class="main-container">
    <div class="header">
      <h1>TN MESSENGER SERVICE</h1>
      <p>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà Dashboard ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
    </div>

    <div class="branch-section-title">
      <i data-feather="map-pin" style="width:24px; height:24px;"></i> ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)
    </div>

    <div id="branchListContainer" class="loading-message">
      ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£...
    </div>

    <div class="action-buttons">
      <button class="action-button" onclick="createWorkOrder()">
        <i data-feather="file-text"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô
      </button>

      <button class="action-button action-status" onclick="checkStatus()">
        <i data-feather="package"></i> ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Tracking)
      </button>
      
      <button class="action-button action-news" onclick="checkNews()">
        <i data-feather="bell"></i> ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£
      </button>
    </div>
    </div>

  <script>
    feather.replace();

    /**
     * ‚úÖ Google Sheet ID ‡∏à‡∏≤‡∏Å URL ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤
     */
    const SHEET_ID = "1wcc009IhaRd95QDOdqgoGCmBWqQQe5nJc4xLxVEpNLQ"; 
    // ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ó‡πá‡∏ö‡∏ä‡∏µ‡∏ï‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£"
    const SHEET_NAME = "‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö"; 
    
    // URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö CSV
    const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}&cacheBust=${Date.now()}`;


    function showMessageBox(title, message) {
      const tempMsg = document.createElement('div');
      tempMsg.className = 'error-message';
      tempMsg.style.backgroundColor = '#e0f7fa'; 
      tempMsg.style.color = '#006064'; 
      tempMsg.style.marginBottom = '20px';
      tempMsg.innerHTML = `<strong>${title}</strong>: ${message}`;

      const main = document.querySelector('.main-container');
      main.insertBefore(tempMsg, main.firstChild.nextSibling);

      setTimeout(() => {
        tempMsg.remove();
      }, 5000);
    }
    
    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô"
     */
    function createWorkOrder() {
      window.location.href = './customer_workorder.html';
    }
    
    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"
     */
    function checkStatus() {
      window.location.href = './tracking_2.html';
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£"
     */
    function checkNews() {
      window.location.href = './news_page.html';
    }

    /**
     * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏≤‡∏Å Google Sheet (‡πÉ‡∏ä‡πâ CSV)
     */
    async function loadBranchData() {
      const container = document.getElementById('branchListContainer');
      container.innerHTML = '<div class="loading-message">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£...</div>';

      try {
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
        const response = await fetch(CSV_URL); 

        if (!response.ok) {
          throw new Error(`Server responded with status: ${response.status}.`);
        }

        const csvText = await response.text();
        
        // 1. ‡πÅ‡∏¢‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏ã‡∏•‡∏•‡πå
        const rows = csvText.split('\n').map(row => row.trim()).filter(row => row.length > 0);
        
        if (rows.length < 2) {
          container.innerHTML = '<div class="loading-message">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ô CSV</div>';
          return;
        }

        // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏¢‡∏Å CSV ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢
        const csvRowToArray = (row) => {
            const result = [];
            let current = '';
            let inQuotes = false;
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim().replace(/^"|"$/g, ''));
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim().replace(/^"|"$/g, '')); 
            return result;
        };

        const header = csvRowToArray(rows[0]);
        const provinceColIndex = header.indexOf('‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î'); // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå '‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î'
        
        if (provinceColIndex === -1) {
             throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏±‡∏ß‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV (‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏™‡∏∞‡∏Å‡∏î‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)');
        }

        // 3. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏à‡∏≤‡∏Å‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        const dataRows = rows.slice(1);
        const provinces = dataRows.map(row => {
            const columns = csvRowToArray(row);
            return columns[provinceColIndex];
        }).filter(province => province && String(province).trim() !== ""); // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á

        
        // 4. ‡∏Å‡∏£‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô
        const uniqueProvinces = [...new Set(provinces)];

        if (uniqueProvinces.length === 0) {
          container.innerHTML = '<div class="loading-message">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</div>';
          return;
        }

        // 5. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        let branchHtml = '<div class="branch-grid">';
        uniqueProvinces.forEach(province => {
          branchHtml += `<div class="branch-card">${province}</div>`;
        });
        branchHtml += '</div>';

        container.innerHTML = branchHtml;

      } catch (error) {
        console.error("Error loading branch data:", error);
        container.innerHTML = `<div class="error-message">
                                <strong>‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢!</strong> ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡πÑ‡∏î‡πâ<br>
                                **‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:** ${error.message}<br>
                                **‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:**<br>
                                1. Google Sheet ID ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà<br>
                                2. Sheet **"${SHEET_NAME}"** ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô **"‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡πÑ‡∏î‡πâ"** ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà<br>
                                3. ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏£‡∏Å‡πÉ‡∏ô Sheet ‡∏Ñ‡∏∑‡∏≠ **"‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î"** ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                               </div>`;
      }
    }

    loadBranchData();
  </script>

</body>

</html>